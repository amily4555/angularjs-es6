> 10-bit JavaScript CPU

[![Build Status][travis-shield]][travis-url]
![npm package][npm-ver-link]

## _ⁿu_
## Install

```sh
npm install nujs
```

## Summary

_nu_ is a 10-bit JavaScript CPU simulation from [nand][1] gates using the [g8][2] library. [nu][3] or [ぬ][3] in Japanese, is also an archaic suffix for verbal stems meaning _not_.

## Usage
_nu_ can be used to simulate a simple computer, such as [Mu][11].

### Arithmetic Logic Unit

```js
const Nu = require('nu-x')

// Compute 1100 → x + y, where x = 1 and y = 3
console.log( Nu.alu('001', '011', '1100').out ) // Log 100
```

### Simple Computer

See [Mu][11] for a more complete example.

```js
// g8 is required to create a register cluster for ram.
const g8 = require('g8')
const Nu = require('nu-x')

// Create the ram, rom and cpu and run a basic program
// that computes RAM[0] = !RAM[0]
var ram = g8.cluster(Nu.WORD, 1024),
    rom = ['0000000000',  // A = 0
           '1110000101'], // M = !M
    cpu = Nu.controller(),
    data = g8.lo(Nu.WORD),
    reset = g8.lo(), i = 0;
while (i = rom[parseInt(cpu.next || 0, 2)])
  data = ram(cpu(i, data, reset).out,
             cpu.address,
             cpu.load);
```

## Instruction Format

Instructions in Nu are 10-bits wide. Each bit or group of bits is decoded and interpreted separately by the CPU. The result of any given instruction can be reading / writing to registers, memory and / or increasing, setting or resetting the [program counter][5]. Instructions bits are evaluated as follows:

* `C000000000` <b>C</b>ompute flag.
* `0LL0000000` <b>L</b>eft side assignment.
* `000Y000000` __Y__ selector flag.
* `0000JJ0000` <b>J</b>ump instructions.
* `000000RRRR` <b>R</b>ight side assignment and result from the [ALU][10].

and used to construct the general function `LEFT = RIGHT, GOTO PC` where:
  * `LEFT` can be the [Accumulator][6] register, serving as both [data][7] and [address][8] registers, X, a general purpose data register, a pointer to a [RAM][9] cell or nothing,
  * `RIGHT` is the result of computing `ALU(X, Y)` where `Y` is either a RAM cell or the accumulator, and
  * `PC`, an address in the program source pointing to the next instruction to fetch.

The opcodes and equivalences described above can be illustrated in the following table:

|            | 00 | 01 | 10 | 11 |
|:----------:|:--:|:--:|:--:|:--:|
| _Compute_  | NO |YES |  ○ |  ○ |
| _Left_     | __ |  A |  X |  M |
| _Y_ flag   |  M |  A |  ○ |  ○ |
| _Jump_     | +1 |< 0 |> 0 |= 0 |
| _Right_    |ALU |

A _no_-compute instruction causes the CPU to save the next 9-bits in the instruction to the accumulator and increase the PC. It is often used to load an address or value to the CPU.

## Controller's Algorithm

> Because code can speak louder than words.

The general function described above is implemented as follows:

```shell
  IF !COMPUTE A = LEFT + Y + JUMP + RIGHT
  ELSE
    OUT = ALU(X, Y ? A : RAM, RIGHT)
    IF LEFT == 01 A = OUT
    ELIF LEFT == 10 X = OUT
    ELIF LEFT == 11 LOAD = true
    IF (OUT < 0 || OUT > 0 || OUT == 0) && JUMP != 00
      PC = A
    ELSE
      PC++
```

## ALUs Opcodes

The 4-bit [ALU][10] in Nu is a simple time-independent combinational circuit implementing up to 2<sup>4</sup> possible functions according to the instruction's `RIGHT` bits.

| Bits | Function | Bits | Function |
|------|:--------:|------|:--------:|
| 0000 |    0     | 0001 |    1     |
| 0010 |    x     | 0011 |    y     |
| 0100 |   !x     | 0101 |   !y     |
| 0110 |   -x     | 0111 |   -y     |
| 1000 |   x+1    | 1001 |   y+1    |
| 1010 |   x-1    | 1011 |   y-1    |
| 1100 |   x+y    | 1101 |   x-y    |
| 1110 |   x&y    | 1111 |   x&#124;y|

## Other Resources

* [nand2tetris][0]
* [Stored Program Concept][13]
* [Von Neumann architecture][14]

## License

MIT © [Jorge Bucaran](http://bucaran.me)

[0]: http://nand2tetris.org
[1]: http://en.wikipedia.org/wiki/NAND_gate
[2]: https://github.com/bucaran/g8
[3]: http://en.wiktionary.org/wiki/%E3%81%AC
[4]: http://en.wikipedia.org/wiki/Niue
[5]: http://en.wikipedia.org/wiki/Program_counter
[6]: http://en.wikipedia.org/wiki/Accumulator_(computing)
[7]: http://en.wikipedia.org/wiki/Memory_data_register
[8]: http://en.wikipedia.org/wiki/Memory_address_register
[9]: http://en.wikipedia.org/wiki/Random-access_memory
[10]: http://en.wikipedia.org/wiki/Arithmetic_logic_unit
[11]: http://github.com/bucaran/mu
[12]: https://github.com/bucaran/nu/issues
[13]: http://en.wikipedia.org/wiki/Stored-program_computer
[14]: http://en.wikipedia.org/wiki/Von_Neumann_architecture

[travis-url]: https://travis-ci.org/bucaran/nu
[travis-shield]: http://img.shields.io/travis/bucaran/nu.svg?style=flat-square

[npm-ver-link]: https://img.shields.io/npm/v/nujs.svg?style=flat-square
